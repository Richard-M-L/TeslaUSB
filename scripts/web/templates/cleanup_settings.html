{% extends "base.html" %}

{% block title %}è‡ªåŠ¨æ¸…ç†è®¾ç½® - Tesla USB å·¥å…·ç®±{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/cleanup.css') }}?v=20251108">
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/cleanup.css') }}?v=20251108">

<div class="container">
    <div class="page-header">
        <a href="{{ url_for('analytics.dashboard') }}" class="btn btn-back">â† è¿”å›å­˜å‚¨åˆ†æä»ªè¡¨æ¿</a>
        <h2>ğŸ§¹ è‡ªåŠ¨æ¸…ç†è®¾ç½®</h2>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if mode != 'edit' %}
        <div class="alert alert-warning">
            <strong>âš ï¸ éœ€è¦è¿›å…¥ç¼–è¾‘æ¨¡å¼</strong><br>
            å¿…é¡»å¤„äºç¼–è¾‘æ¨¡å¼æ‰èƒ½é…ç½®å’Œè¿è¡Œè‡ªåŠ¨æ¸…ç†ã€‚
            <a href="{{ url_for('mode_control.index') }}">åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼</a>
        </div>
    {% endif %}
    <!-- Help Card -->
    <div class="cleanup-card help-card">
        <h3>â„¹ï¸ è‡ªåŠ¨æ¸…ç†åŠŸèƒ½è¯´æ˜</h3>
        <ul>
            <li><strong>æ‰‹åŠ¨æ¸…ç†:</strong> ä½¿ç”¨â€œé¢„è§ˆæ¸…ç†æ•ˆæœâ€å¯ä»¥å…ˆæŸ¥çœ‹å°†è¦åˆ é™¤çš„æ–‡ä»¶åˆ—è¡¨ï¼Œç„¶åé€‰æ‹©æ˜¯å¦æ‰§è¡Œã€‚ä¸å—â€œå¼€æœºè‡ªåŠ¨æ¸…ç†â€å¼€å…³å½±å“ã€‚</li>
            <li><strong>è‡ªåŠ¨æ¸…ç†:</strong> å½“æŸä¸ªæ–‡ä»¶å¤¹å¼€å¯â€œå¼€æœºæ—¶è‡ªåŠ¨æ¸…ç†â€åï¼Œç³»ç»Ÿä¼šåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼ˆå‘ Tesla å‘ˆç° USB ä¹‹å‰ï¼‰è‡ªåŠ¨åˆ é™¤ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ã€‚</li>
            <li><strong>EncryptedClips:</strong> è¿™äº›è§†é¢‘é€šå¸¸æ˜¯ç‰¹æ–¯æ‹‰åœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹ï¼ˆä¾‹å¦‚æ¶‰åŠéšç§ã€æ³•å¾‹å–è¯æˆ–å®‰å…¨äº‹ä»¶ï¼‰è‡ªåŠ¨åŠ å¯†ä¿å­˜çš„ â€” é»˜è®¤å…³é—­ã€‚</li>
            <li><strong>Photobooth:</strong> ç…§ç›¸äº­æ‹çš„ç…§ç‰‡ï¼Œåç»­æ›´æ–°æ¸…ç†ç…§ç‰‡åŠŸèƒ½ â€” ä¸å¤ªé‡è¦ã€‚</li>
            <li><strong>RecentClips:</strong> æ™®é€šè¡Œè½¦è®°å½•è§†é¢‘ â€” å»ºè®®å¯è®¾ç½®è‡ªåŠ¨åˆ é™¤æ—§è§†é¢‘ã€‚</li>
            <li><strong>SavedClips:</strong> ç”¨æˆ·æ‰‹åŠ¨ä¿å­˜çš„è§†é¢‘ â€” é»˜è®¤å…³é—­ä»¥ä¿æŠ¤é‡è¦ç‰‡æ®µã€‚</li>
            <li><strong>SentryClips:</strong> å“¨å…µæ¨¡å¼å®‰å…¨äº‹ä»¶è§†é¢‘ â€” é»˜è®¤å…³é—­ä»¥é˜²è¯¯åˆ ã€‚</li>

            <li><strong>ä¿æŠ¤æœºåˆ¶:</strong> æœ€è¿‘ 1 å°æ—¶å†…çš„è§†é¢‘æ°¸è¿œä¸ä¼šè¢«åˆ é™¤ï¼ˆå¯èƒ½æ­£åœ¨å½•åˆ¶ä¸­ï¼‰ã€‚</li>
            <li><strong>å¯åŠ¨æµç¨‹:</strong> å¼€æœºæ—¶ç³»ç»Ÿä¼šä»¥è¯»å†™æ¨¡å¼æŒ‚è½½åˆ†åŒº â†’ æ‰§è¡Œå¯ç”¨çš„æ–‡ä»¶å¤¹æ¸…ç† â†’ å¸è½½å¹¶ä»¥ USB è®¾å¤‡æ¨¡å¼å‘ˆç°ç»™ Teslaã€‚</li>
        </ul>
    </div>
    <form method="POST" action="{{ url_for('cleanup.save_settings') }}" class="cleanup-form">
        <!-- Dynamic folder settings based on detected folders -->
        {% for folder_name, policy in policies.items() %}
        <div class="cleanup-card folder-card">
            <div class="folder-header">
                <h2>
                    {% if folder_name == 'RecentClips' %}ğŸš—
                    {% elif folder_name == 'SavedClips' %}â­
                    {% elif folder_name == 'SentryClips' %}ğŸš¨
                    {% elif folder_name == 'EncryptedClips' %}ğŸ”’
                    {% else %}ğŸ“
                    {% endif %}
                    {{ folder_name }}
                </h2>
                <label class="toggle-switch">
                    <input type="checkbox" name="{{ folder_name }}_enabled"
                           {% if policy['enabled'] %}checked{% endif %}
                           {% if mode != 'edit' %}disabled{% endif %}>
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">
                        å¼€æœºæ—¶è‡ªåŠ¨æ¸…ç†æ­¤æ–‡ä»¶å¤¹
                        {% if folder_name in ['SavedClips', 'SentryClips', 'EncryptedClips'] %}
                        (âš ï¸ ä¸æ¨èå¼€å¯)
                        {% endif %}
                    </span>
                </label>
            </div>

            <div class="policy-options">
                <div class="policy-option">
                    <label class="checkbox-label">
                        <input type="checkbox" name="{{ folder_name }}_age_enabled"
                               {% if policy['age_based']['enabled'] %}checked{% endif %}
                               {% if mode != 'edit' %}disabled{% endif %}>
                        æŒ‰æ—¶é—´æ¸…ç†ï¼šåˆ é™¤æ—©äº
                    </label>
                    <input type="number" name="{{ folder_name }}_age_days"
                           value="{{ policy['age_based']['days'] }}"
                           min="1" max="3650" class="number-input"
                           {% if mode != 'edit' %}disabled{% endif %}> å¤©å‰çš„è§†é¢‘
                </div>

                {% if 'size_based' in policy %}
                <div class="policy-option">
                    <label class="checkbox-label">
                        <input type="checkbox" name="{{ folder_name }}_size_enabled"
                               {% if policy['size_based']['enabled'] %}checked{% endif %}
                               {% if mode != 'edit' %}disabled{% endif %}>
                        æŒ‰å®¹é‡æ¸…ç†ï¼šæœ€å¤šä¿ç•™
                    </label>
                    <input type="number" name="{{ folder_name }}_size_gb"
                           value="{{ policy['size_based']['max_gb'] }}"
                           min="1" max="1000" class="number-input"
                           {% if mode != 'edit' %}disabled{% endif %}> GB
                </div>
                {% endif %}

                {% if 'count_based' in policy %}
                <div class="policy-option">
                    <label class="checkbox-label">
                        <input type="checkbox" name="{{ folder_name }}_count_enabled"
                               {% if policy['count_based']['enabled'] %}checked{% endif %}
                               {% if mode != 'edit' %}disabled{% endif %}>
                        æŒ‰æ•°é‡æ¸…ç†ï¼šåªä¿ç•™æœ€æ–°çš„
                    </label>
                    <input type="number" name="{{ folder_name }}_count_videos"
                           value="{{ policy['count_based']['max_videos'] }}"
                           min="1" max="10000" class="number-input"
                           {% if mode != 'edit' %}disabled{% endif %}> ä¸ªè§†é¢‘
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}

        <!-- Action Buttons -->
        <div class="button-group">
            <button type="submit" class="btn btn-primary" {% if mode != 'edit' %}disabled{% endif %}>ğŸ’¾ ä¿å­˜è®¾ç½®</button>
            <a href="{{ url_for('cleanup.preview') }}" class="btn btn-secondary {% if mode != 'edit' %}disabled{% endif %}">ğŸ” é¢„è§ˆæ¸…ç†æ•ˆæœ</a>
        </div>
    </form>
</div>
{% endblock %}
